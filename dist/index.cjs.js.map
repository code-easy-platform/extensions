{"version":3,"file":"index.cjs.js","sources":["../src/lib/WorkerMessageReceiver.ts","../src/lib/WorkerMessageSender.ts","../src/lib/runner/ExtensionWorker.ts","../src/lib/runner/ExtensionLoader.ts","../src/lib/runner/ExtensionRunner.ts","../src/lib/Extension.ts"],"sourcesContent":["\r\nexport class WorkerMessageReceiver {\r\n  public onMessage: ((event: MessageEvent) => void) | null = null;\r\n\r\n\r\n  constructor(private _target: Window | Worker) {\r\n    this._target.addEventListener('error', this._onErrorEvent.bind(this));\r\n    this._target.addEventListener('message', this._onMessageEvent.bind(this));\r\n    this._target.addEventListener('messageerror', this._onErrorMessageEvent.bind(this));\r\n  }\r\n\r\n\r\n  private _respond(messageId: string) {\r\n    this._target.postMessage({ messageId, type: 'response' });\r\n  }\r\n\r\n  private _onMessageEvent(event: MessageEvent | Event) {\r\n    if (!(event instanceof MessageEvent)) return;\r\n    if (event.data.type !== 'request') return;\r\n\r\n    this.onMessage?.(event.data.payload);\r\n    this._respond(event.data.messageId);\r\n  }\r\n\r\n  private _onErrorEvent(event: MessageEvent | Event) {\r\n    if (!(event instanceof MessageEvent)) return;\r\n\r\n    console.log(event);\r\n  }\r\n\r\n  private _onErrorMessageEvent(event: MessageEvent | Event) {\r\n    if (!(event instanceof MessageEvent)) return;\r\n\r\n    console.log(event);\r\n  }\r\n}\r\n\r\n\r\n","import { IMessage } from './IMessage';\r\n\r\n\r\nexport class WorkerMessageSender {\r\n  private _messageQueue: Record<string, (() => void)> = {};\r\n\r\n\r\n  constructor(private _target: Window | Worker) {\r\n    this._target.addEventListener('message', this._onMessageEvent.bind(this));\r\n  }\r\n\r\n\r\n  public async send<T>(message: IMessage<T>) {\r\n    return new Promise((resolve, reject) => {\r\n      const newMessageId = crypto.randomUUID();\r\n\r\n      this._messageQueue[newMessageId] = () => {\r\n        delete this._messageQueue[newMessageId];\r\n        resolve('complete');\r\n      };\r\n\r\n      this._target.postMessage({\r\n        type: 'request',\r\n        payload: message,\r\n        messageId: newMessageId,\r\n      });\r\n\r\n\r\n      setTimeout(() => {\r\n        delete this._messageQueue[newMessageId];\r\n        reject('Time out');\r\n      }, 500);\r\n    });\r\n  }\r\n\r\n\r\n  private _onMessageEvent(event: MessageEvent | Event) {\r\n    if (!(event instanceof MessageEvent)) return;\r\n    if (event.data.type !== 'response') return;\r\n\r\n    this._messageQueue[event.data.messageId]?.();\r\n  }\r\n}\r\n","import { WorkerMessageReceiver } from '../WorkerMessageReceiver';\nimport { WorkerMessageSender } from '../WorkerMessageSender';\nimport { IMessage } from '../IMessage';\n\n\nexport class ExtensionWorker {\n  private _worker: Worker | null = null;\n  private _workerMessageSender: WorkerMessageSender | null = null;\n  private _workerMessageReceiver: WorkerMessageReceiver | null = null;\n\n\n  private _ready = false;\n  public get ready() { return this._ready; }\n\n  private _hasError = false;\n  public get hasError() { return this._hasError; }\n\n  private _hasInitialized = false;\n  public get hasInitialized() { return this._hasInitialized; }\n\n\n  constructor(\n    url: string,\n    onReceive: (_message: IMessage) => void,\n  ) {\n    const workerUrl = URL.createObjectURL(\n      new Blob(\n        [`import(\"${url}\").then(m => new m.default(self))`],\n        { type: \"text/javascript\" }\n      )\n    );\n\n    this._worker = new Worker(workerUrl, { type: 'module' });\n    setTimeout(() => URL.revokeObjectURL(workerUrl), 0);\n\n    this._workerMessageSender = new WorkerMessageSender(this._worker);\n    this._workerMessageReceiver = new WorkerMessageReceiver(this._worker);\n\n    this._workerMessageReceiver.onMessage = message => this._onReceive(message, onReceive);\n  }\n\n\n  public async activate() {\n    await this._workerMessageSender?.send({ type: 'activate' })\n      .then(() => {\n        this._hasInitialized = true;\n      })\n      .catch(() => {\n        this._hasError = true;\n        console.warn('Failed to activate a extension');\n      });\n  }\n\n  public async deactivate() {\n    await this._workerMessageSender?.send({ type: 'deactivate' })\n      .then(() => {\n        this._worker?.terminate();\n\n        this._worker = null;\n        this._hasInitialized = false;\n        this._workerMessageSender = null;\n      })\n      .catch(() => console.warn('Failed to deactivate a extension'));\n  }\n\n  public async send<T>(message: IMessage<T>) {\n    return await this._workerMessageSender?.send(message);\n  }\n\n\n  private _onReceive(message: IMessage, onReceive: (_message: IMessage) => void,) {\n    switch (message.type) {\n      case 'ready':\n        this._ready = true;\n        onReceive(message);\n        this.activate();\n        break;\n\n      default:\n        onReceive(message);\n        break;\n    }\n  }\n}\n","import { IManifest } from './IManifest';\n\n\nexport class ExtensionLoader {\n  private _urlRoot: URL;\n  private _cancelSignal: AbortController;\n\n  public extensionPackageUrl: string;\n\n  public name: string | null = null;\n  public version: string | null = null;\n  public description: string | null = null;\n  public extensionCodeUrl: string | null = null;\n  public extensionManifestUrl: string | null = null;\n\n\n  constructor(extension: string) {\n    if (URL.canParse(extension)) {\n      if (extension.endsWith('package.json')) {\n        this._urlRoot = new URL(extension.replace('package.json', ''));\n      } else {\n        this._urlRoot = new URL(extension);\n      }\n    } else {\n      try {\n        this._urlRoot = new URL(`https://cdn.jsdelivr.net/npm/${extension}/`);\n      } catch (error) {\n        console.log(error);\n        throw new Error('Error when try to parse the extension URL');\n      }\n    }\n\n    this._cancelSignal = new AbortController();\n\n    this.extensionPackageUrl = this._urlRoot.href.concat('package.json');\n    fetch(this.extensionPackageUrl, { signal: this._cancelSignal.signal })\n      .then(res => res.json())\n      .then(data => {\n        this.name = data.name;\n        this.version = data.version;\n        this.description = data.description;\n        this.extensionCodeUrl = new URL(data.module, this._urlRoot.href).toString();\n        this.extensionManifestUrl = new URL(data.manifest, this._urlRoot.href).toString();\n\n        this.onPackageLoaded(data);\n      })\n      .catch(error => {\n        console.log(error);\n      });\n  }\n\n  public onExtensionLoaded(_packageData: Record<string, any>, _manifest: IManifest) { }\n\n\n  public cancelLoad() {\n    this._cancelSignal.abort('Request canceled by the user');\n  }\n\n\n  private onPackageLoaded(packageData: any) {\n    if (!this.extensionManifestUrl) throw new Error('Manifest URL not found')\n    if (!this.extensionCodeUrl) throw new Error('Code URL not found')\n\n    fetch(this.extensionManifestUrl)\n      .then(res => res.json())\n      .then((manifestData) => {\n        this.onExtensionLoaded(packageData, manifestData);\n      });\n  }\n}\n","import { ExtensionWorker } from './ExtensionWorker';\r\nimport { ExtensionLoader } from './ExtensionLoader';\r\nimport { IExporter } from '../IExporter';\r\nimport { IMessage } from '../IMessage';\r\n\r\n\r\nexport class ExtensionRunner {\r\n  public static debug = false;\r\n  private _debug(key: string, ...rest: any[]) {\r\n    if (!ExtensionRunner.debug) return;\r\n    console.log(key, ...rest);\r\n  }\r\n\r\n  private _extensionId: string;\r\n  private _extensionLoader: ExtensionLoader;\r\n  private _extensionWorker: ExtensionWorker | null = null;\r\n\r\n  public name: string | null = null;\r\n  public version: string | null = null;\r\n  public packageName: string | null = null;\r\n  public description: string | null = null;\r\n  public exporters: IExporter[] = [];\r\n\r\n\r\n  constructor(url: string);\r\n  constructor(packageName: string);\r\n  constructor(extensionPackageOrUrl: string) {\r\n    this._debug('start - extensionPackageOrUrl', extensionPackageOrUrl);\r\n\r\n    this._extensionId = crypto.randomUUID();\r\n    this._extensionLoader = new ExtensionLoader(extensionPackageOrUrl);\r\n\r\n    this._extensionLoader.onExtensionLoaded = (_packageData, _manifestData) => {\r\n      this._debug('extension - loaded', _packageData, _manifestData);\r\n\r\n      this.name = _manifestData.name;\r\n      this.description = _manifestData.description;\r\n      this.packageName = _manifestData.packageName;\r\n      this.version = this._extensionLoader.version;\r\n\r\n      this.exporters = _manifestData.exporters.map(exporterData => ({\r\n        label: exporterData.label,\r\n        description: exporterData.description,\r\n        key: `${this._extensionId}::${exporterData.key}`,\r\n        action: async (data: { project: Object }) => {\r\n          this._debug('exporter - data,exporter', data, exporterData);\r\n          await this._extensionWorker?.send({ payload: data, type: `exporters:${exporterData.key}` })\r\n        },\r\n      }));\r\n\r\n      this._extensionWorker = new ExtensionWorker(this._extensionLoader.extensionCodeUrl || '', this._onReceive.bind(this));\r\n    }\r\n  }\r\n\r\n\r\n  public async deactivate() {\r\n    this._extensionLoader.cancelLoad();\r\n    await this._extensionWorker?.deactivate();\r\n    ExtensionRunner.removeExporters(this.exporters.map(exporter => exporter.key));\r\n  }\r\n\r\n\r\n  private _onReceive(message: IMessage) {\r\n    switch (message.type) {\r\n      case 'feedback':\r\n        this._handleFeedback(message.payload);\r\n        break;\r\n      case 'download:file':\r\n        this._handleDownloadFile(message.payload);\r\n        break;\r\n      case 'ready':\r\n        console.log('Pronto, carregado');\r\n        ExtensionRunner.addExporters(this.exporters);\r\n        break;\r\n\r\n      default: break;\r\n    }\r\n  }\r\n\r\n  private _handleDownloadFile(payload: { fileName: string; fileType: string; fileContent: string; }) {\r\n    if (!payload) return;\r\n\r\n    ExtensionRunner.downloadFile(payload.fileName, payload.fileType, payload.fileContent);\r\n  }\r\n\r\n  private _handleFeedback(payload: { message: string; type: 'warning' | 'success' | 'error' | 'info'; }) {\r\n    if (!payload) return;\r\n\r\n    ExtensionRunner.feedback(payload.message, payload.type);\r\n  }\r\n\r\n\r\n  public static addExporters(_exporters: IExporter[]) {\r\n    throw new Error(\"Download file method not implemented yet\");\r\n  }\r\n\r\n  public static removeExporters(_keys: string[]) {\r\n    throw new Error(\"Download file method not implemented yet\");\r\n  }\r\n\r\n  public static downloadFile(_fileName: string, _fileType: string, _fileContent: string) {\r\n    throw new Error(\"Download file method not implemented yet\");\r\n  }\r\n\r\n  public static feedback(_message: string, _type: 'warning' | 'success' | 'error' | 'info') {\r\n    throw new Error(\"Feedback method not implemented yet\");\r\n  }\r\n}\r\n","import { WorkerMessageReceiver } from './WorkerMessageReceiver';\r\nimport { WorkerMessageSender } from './WorkerMessageSender';\r\nimport { IMessage } from './IMessage';\r\n\r\n\r\n\r\nexport abstract class Extension {\r\n  private _commands: Record<string, ((data: any) => void)> = {};\r\n\r\n  private _workerReceiver: WorkerMessageReceiver;\r\n  private _workerSender: WorkerMessageSender;\r\n\r\n\r\n  constructor(_target: Window | Worker) {\r\n    this._workerReceiver = new WorkerMessageReceiver(_target);\r\n    this._workerSender = new WorkerMessageSender(_target);\r\n\r\n    this._commands['activate'] = this.activate.bind(this);\r\n    this._commands['deactivate'] = this.deactivate.bind(this);\r\n\r\n    this._workerReceiver.onMessage = this._onEvent.bind(this);\r\n\r\n    this._handleReady();\r\n  }\r\n\r\n\r\n  /**\r\n   * First function call when extension starts.\r\n   */\r\n  public abstract activate(): void;\r\n  /**\r\n   * Last function call when extension ends.\r\n   */\r\n  public abstract deactivate(): void;\r\n\r\n\r\n  /**\r\n   * All available commands to do in the platform\r\n   */\r\n  public readonly commands = {\r\n    /**\r\n     * Allow you to add a project exporter in the platform. You can develop a code export.\r\n     * \r\n     * @param key Key of the exporter previous added\r\n     * @param action Function to be executed when the event was called\r\n     */\r\n    addExporter: async (key: string, action: ((data: any) => void)) => {\r\n      const commandKey = `${key}`;\r\n      console.log('add export', commandKey, action);\r\n      this._commands[`exporters:${commandKey}`] = action.bind(this);\r\n    },\r\n    /**\r\n     * Used to remove the project exporter\r\n     * \r\n     * @param key Key of the exporter previous added\r\n     */\r\n    removeExporter: async (key: string) => {\r\n      const commandKey = `${key}`;\r\n      console.log('remove export', commandKey);\r\n      delete this._commands[`exporters:${commandKey}`];\r\n    },\r\n    /**\r\n     * Allow you to download some content in a file\r\n     * \r\n     * @param fileName Name of the generated file\r\n     * @param fileType extension of the file\r\n     * @param fileContent file content in string\r\n     */\r\n    downloadFile: async (fileName: string, fileType: string, fileContent: string) => {\r\n      await this._workerSender.send({\r\n        type: 'download:file',\r\n        payload: { fileName, fileType, fileContent },\r\n      });\r\n    },\r\n    /**\r\n     * Allow to show some feedback to the platform user\r\n     * \r\n     * @param message Message of the feedback\r\n     * @param type type of the feedback\r\n     */\r\n    feedback: async (message: string, type: 'warning' | 'success' | 'error' | 'info') => {\r\n      await this._workerSender.send({\r\n        type: 'feedback',\r\n        payload: { message, type },\r\n      });\r\n    },\r\n  } as const;\r\n\r\n\r\n  private _onEvent(message: IMessage) {\r\n    console.log('message', message, this._commands);\r\n    this._commands[message.type]?.(message.payload);\r\n  }\r\n\r\n  private async _handleReady() {\r\n    await this._workerSender.send({ type: 'ready' });\r\n  }\r\n}\r\n"],"names":["WorkerMessageReceiver","_target","messageId","event","_a","WorkerMessageSender","message","resolve","reject","newMessageId","_b","ExtensionWorker","url","onReceive","workerUrl","ExtensionLoader","extension","error","res","data","_packageData","_manifest","packageData","manifestData","_ExtensionRunner","extensionPackageOrUrl","_manifestData","exporterData","key","rest","exporter","payload","_exporters","_keys","_fileName","_fileType","_fileContent","_message","_type","ExtensionRunner","Extension","action","commandKey","fileName","fileType","fileContent","type"],"mappings":"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"}